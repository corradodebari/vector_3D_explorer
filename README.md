# vector_3D_explorer
Interactive 3D vectors explorer using Oracle DB 23ai + matplotlib.

![application gui](./images/vector_3d_explorer.png)

## How it works
1. A sample of the original tables generated by Langchain Vector Store API's on Oracle DB23ai is created, in order to works on a random uniform distributed subset that could be actually shown on a chart:
   
```SQL
    CREATE TABLE {table_vect} AS
        SELECT 
            RAWTOHEX(ID) AS ID,
            EMBEDDING,
            TEXT
        FROM (
            SELECT *
            FROM {base_table}
            ORDER BY STANDARD_HASH(ID || '{CFG.seed}', 'SHA1')
        )
        FETCH FIRST {CFG.pca_fit_rows} ROWS ONLY
```

2. Create a model for a dimensional reduction based on the sample table  provided:
```SQL
    DECLARE
        v_setlst DBMS_DATA_MINING.SETTING_LIST;
    BEGIN
        v_setlst('ALGO_NAME')         := 'ALGO_SINGULAR_VALUE_DECOMP';
        v_setlst('SVDS_SCORING_MODE') := 'SVDS_SCORING_PCA';
        v_setlst('FEAT_NUM_FEATURES') := '3';

        DBMS_DATA_MINING.CREATE_MODEL2(
            MODEL_NAME          => '{pca_model}',
            MINING_FUNCTION     => 'FEATURE_EXTRACTION',
            DATA_QUERY          => 'SELECT EMBEDDING FROM {table_vect}',
            CASE_ID_COLUMN_NAME => NULL,
            SET_LIST            => v_setlst
        );
    END;
```

- ALGO_SINGULAR_VALUE_DECOMP â†’ selects Singular Value Decomposition (SVD) as the algorithm.

- SVDS_SCORING_PCA â†’ tells the system to use the PCA-style scoring, meaning it reduces the data to the top singular components and interprets them as principal components (variance-maximizing directions).

ðŸ‘‰ Together: Run SVD, then use it in PCA mode to produce reduced-dimensional vectors.

3. Apply the model to the subset table to represent in 3D the original vector embeddings:
   
```SQL
       CREATE OR REPLACE VIEW {view_reduced} AS
        SELECT
            ID,
            VECTOR_EMBEDDING({pca_model} USING *) AS EMBEDDING3D,
            TEXT,
            EMBEDDING
        FROM {table_vect}
```

4. Let's search with similarity search:
```SQL
    SELECT ID
        FROM {table_vect}
        ORDER BY VECTOR_DISTANCE(
            EMBEDDING,
            (SELECT EMBEDDING FROM {table_vect} WHERE ID = :1),
            {metric}
        )
        FETCH EXACT FIRST {n} ROWS ONLY
```

5. To make intelligeble the chart, 
```SQL
     CREATE TABLE {sampled_view} AS
        SELECT *
        FROM (
            SELECT *
            FROM {view_name}
            ORDER BY STANDARD_HASH(ID || '{CFG.seed}', 'SHA1')
        )
        FETCH FIRST {n} ROWS ONLY
```

## Getting Started

Follow these steps to try the code:

- Install env:
    ```
    python3.11 -m venv .venv
    source .venv/bin/activate
    pip install oracledb numpy matplotlib
    ```

- Install the Oracle DB instant client you can get from [here](https://www.oracle.com/database/technologies/instant-client/downloads.html), and set the env variable to reference it. Ex.:

    ```
    export = export LIB_DIR="/Users/cdebari/instantclient_23_3"
    ```

- Start the app by command-line, or setting a [start](start.sh) shell script. Ex.:
    ```
    source .venv/bin/activate
    python vector_3d_explorer.py --dsn "localhost:1521/FREEPDB1" --user "vector" --password "vector" --table "OLLAMA_MXBAI_EMBED_LARGE_8192_1639_COSINE_HNSW" --distance-metric-default "EUCLIDEAN" --topk 10 --subset-dim 500 --subset-dim-plot 100
    ```